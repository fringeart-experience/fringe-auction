<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fringe Auction</title>

  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      font-size: 20px;
    }
    img {
      width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    h1 {
      color: #085651;
      font-size: 26px;
      text-align: center;
      margin-bottom: 5px;
      margin-top: 35px;
    }
    #status {
      margin-top: 10px;
      font-weight: bold;
      color: #C26363;
      text-align: center;
    }
    form {
      margin-top: 20px;
      font-size: 18px;
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
      font-size: 20px;
    }
    button {
      background: #085651;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #555;
    }
    .subtitle {
      font-size: 16px;
      text-align: center;
      margin-top: 2px;
      margin-bottom: 5px;
    }
    .current-leader-display {
      color: #C26363;
      font-weight: bold;
      text-align: center;
    }
    #bidNote {
      font-size: 16px;
      text-align: center;
      margin: 10px 0;
      color: #085651;
    }
    .intro {
      font-size: 20px;
    }
  </style>
</head>

<body>

  <a href="https://www.fringeart.org">
    <img src="Dec2025_SteedDonatedOrnaments.jpeg" width="3024" height="3024" alt="">
  </a>

  <h1><strong>12 ARTISTS - 12 AUCTIONS - 12 ARTWORKS</strong></h1>

  <p class="intro">This month's featured auction item is a curated collection of five handmade ornaments by Fringe member artists 
    <a href="https://www.fringeart.org/maggieboudreaux">Maggie Boudreaux</a>,
    <a href="https://www.fringeart.org/shellynealy">Shelly Nealy</a>, and
    <a href="https://www.fringeart.org/emilypullin">Emily Pullin</a>.
  </p>

  <p id="countdown" style="text-align:center; padding: 10px 0; font-weight:bold; color:#C26363; font-size:20px;">
    Auction begins in: loading...
  </p>

  <!-- Current Leader -->
  <p class="current-leader-display" id="currentLeaderContainer">
    Current Leader: <span id="currentLeader">Loading...</span> with a bid of $<span id="currentBid">Loading...</span>
  </p>

  <!-- Bid Form -->
  <form id="bidForm">
    <label><strong>Bidder Name:</strong>
      <input type="text" id="bidderName" required />
    </label>

    <label><strong>Bidding Nickname (optional):</strong>
      <input type="text" id="bidderNickname" />
    </label>

    <label><strong>Bidder Email:</strong>
      <input type="email" id="bidderEmail" required />
    </label>

    <label><strong>Bid Amount:</strong></label>
    <span style="display: inline-flex; align-items: center; width: 100%;">
      <span><strong>$</strong>&nbsp;</span>
      <input type="number" id="bidAmount" required min="100" step="10" style="flex:1;" />
    </span>

    <p id="bidNote">Loading bidding information...</p>

    <button type="submit">Place Bid</button>
  </form>

  <p id="status"></p>

  <!-- Hidden Auction Metadata -->
  <div id="auction-meta"
       data-start="2025-12-01T09:00:00-06:00"
       data-end="2025-12-20T21:00:00-06:00"
       data-auction-id="ornamentsDec2025"
       style="display:none;"></div>

  <!-- Countdown Script -->
  <script>
    const meta = document.getElementById("auction-meta");
    const startTime = new Date(meta.dataset.start).getTime();
    const endTime = new Date(meta.dataset.end).getTime();
    const countdownEl = document.getElementById("countdown");

    function formatTime(ms) {
      let s = Math.floor(ms / 1000);
      let d = Math.floor(s / 86400);
      s %= 86400;
      let h = Math.floor(s / 3600);
      s %= 3600;
      let m = Math.floor(s / 60);
      s %= 60;
      return `${d}d ${h}h ${m}m ${s}s`;
    }

    function updateCountdown() {
      const now = Date.now();
      if (now < startTime) {
        countdownEl.textContent = "Auction begins in: " + formatTime(startTime - now);
      } else if (now < endTime) {
        countdownEl.textContent = "Auction ends in: " + formatTime(endTime - now);
      } else {
        countdownEl.textContent = "Auction has ended.";
      }
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
  </script>

  <!-- Firebase + Auction Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getDatabase, ref, onValue, push, update } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    window.addEventListener("DOMContentLoaded", () => {
      const firebaseConfig = {
        apiKey: "AIzaSyBTmrFoE2kyAFvZVqkhhuJaOFCXBbRq-8M",
        authDomain: "auctions-fringe12.firebaseapp.com",
        projectId: "auctions-fringe12",
        storageBucket: "auctions-fringe12.firebasestorage.app",
        messagingSenderId: "534345798049",
        appId: "1:534345798049:web:4d71d0f4a6c18782847be0",
        measurementId: "G-4ZB48GFTNN",
        databaseURL: "https://auctions-fringe12-default-rtdb.firebaseio.com"
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      const artworkRef = ref(db, 'fringeAuction/artwork1');
      const bidsRef = ref(db, 'fringeAuction/artwork1/bids');

      // Write metadata (this is safe)
      const metaRef = ref(db, 'fringeAuction/artwork1/meta');
      update(metaRef, {
        start: meta.dataset.start,
        end: meta.dataset.end,
        auctionId: meta.dataset.auctionId
      });

      // Live Updating Display
      onValue(artworkRef, (snapshot) => {
        const data = snapshot.val() || {};
        const currentBid = data.currentBid || 0;

        document.getElementById('currentBid').textContent = currentBid;
        document.getElementById('currentLeader').textContent = data.bidderNickname || "No bids yet";

        const nextBid = currentBid > 0 ? currentBid + 10 : 100;
        document.getElementById('bidAmount').value = nextBid;
        document.getElementById('bidNote').textContent =
          currentBid ? `Next minimum bid: $${nextBid}` : `Bidding starts at $100`;
      });

      // Handle Form Submit
      document.getElementById('bidForm').addEventListener('submit', (e) => {
        e.preventDefault();

        const name = document.getElementById('bidderName').value.trim();
        const email = document.getElementById('bidderEmail').value.trim();
        const nickname = document.getElementById('bidderNickname').value.trim() || "Anonymous";
        const amount = parseFloat(document.getElementById('bidAmount').value);

        update(artworkRef, {
          currentBid: amount,
          bidderName: name,
          bidderNickname: nickname,
          bidderEmail: email,
        });

        push(bidsRef, {
          bidAmount: amount,
          bidderName: name,
          bidderNickname: nickname,
          bidderEmail: email,
          timestamp: Date.now()
        });

        document.getElementById('status').textContent = "âœ” Bid submitted successfully!";
      });

    });
  </script>

</body>
</html>